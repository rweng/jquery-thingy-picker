<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>coffeescript/jquery-thingy-picker.js.coffee - jQuery ThingyPicker</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="jQuery ThingyPicker"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ThingyItem.html">ThingyItem</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: coffeescript/jquery-thingy-picker.js.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">
# call with $(el).thingyPicker(items: [item])
# item must be {id: ..., picture: ..., name: ...}
(($)-&gt;

  ###*
  A ThingyItem is a single, selectable item in a ThingyPicker

  @class ThingyItem
  @constructor
  ###
  ThingyItem = (data, picker) -&gt;
    this.$el = $el = $(ThingyItem.itemToHtml(data))
    this.picker = picker
    this.data = data
    item = this
    $el.data(&quot;tp-item&quot;, this)

    this.on = (event, handler) -&gt;
      $el.on(event, handler)

    this.select = -&gt;
      console.log $el.hasClass(&quot;selected&quot;)
      unless item.isSelected()
        console.log(&quot;selection&quot;)
        $el.addClass(&#x27;selected&#x27;)
        $el.trigger(&#x27;selection-changed&#x27;)

    ###*
    @method isSelected
    @return {Boolean}
    ###
    this.isSelected = -&gt;
      $el.hasClass(&quot;selected&quot;)

    # handle when a item is clicked for selection
    $el.click (event) -&gt;
      console.log &quot;clicked&quot;
      #if the element is being selected, test if the max number of items have
      #already been selected, if so, just return
      if picker.hasMaxSelected() and not item.isSelected()
        console.log(&quot;returning since picker.MaxSelected reached&quot;)
        return

      item.select()

    return this

  ThingyItem.itemToHtml = undefined

  ThingyPicker = (element, options) -&gt;
    this.$el = elem = $(element)
    picker = this
    settings = $.extend({
      debug: false
      maxSelected: -1
      preSelectedItems: []
      excludeItems: []
      items: []
      isItemFiltered: ($item, filterText) -&gt;
        itemName = $item.find(&quot;.item-name&quot;).text()
        not new RegExp(filterText, &quot;i&quot;).test(itemName)
      itemToHtml: (contact) -&gt;
        &quot;&lt;div class=&#x27;item&#x27; id=&#x27;#{contact.id}&#x27;&gt;&lt;img src=&#x27;#{contact.picture}&#x27;/&gt;&lt;div class=&#x27;item-name&#x27;&gt;#{contact.name}&lt;/div&gt;&lt;/div&gt;&quot;
      sorter: (a, b) -&gt;
        x = a.name.toLowerCase()
        y = b.name.toLowerCase()
        ((x &lt; y) ? -1 : ((x &gt; y) ? 1 : 0))
      ,
      labels: {
        selected: &quot;Selected&quot;,
        filter_placeholder: &quot;Start typing a name&quot;,
        find_items: &quot;Find items:&quot;,
        all: &quot;All&quot;,
        max_selected_message: &quot;{0} of {1} selected&quot;
      }
    }, options || {})

    lastSelected = undefined # used when shift-click is performed to know where to start from to select multiple elements
    ThingyItem.itemToHtml = settings.itemToHtml

    # ----------+----------+----------+----------+----------+----------+----------+
    # Public functions
    # ----------+----------+----------+----------+----------+----------+----------+

    this.getSelectedIds = -&gt;
      ids = []
      $.each(elem.find(&quot;.item.selected&quot;), (i, item) -&gt;
        ids.push($(item).attr(&quot;id&quot;))
      )
      return ids

    this.getSelectedIdsAndNames = -&gt;
      selected = []
      $.each(elem.find(&quot;.item.selected&quot;), (i, item) -&gt;
        selected.push( {id: $(item).attr(&quot;id&quot;), name: $(item).find(&quot;.item-name&quot;).text()})
      )
      return selected

    this.getSelectedItems = -&gt;
      elem.find(&#x27;.item.selected&#x27;)

    this.hasMaxSelected = -&gt;
      settings.maxSelected &gt;= picker.getSelectedItems().length

    this.allItems = -&gt;
      elem.find(&#x27;.item&#x27;)

    this.clearSelected = -&gt;
      picker.allItems().removeClass(&quot;selected&quot;)
      return elem


    # ----------+----------+----------+----------+----------+----------+----------+
    # Private functions
    # ----------+----------+----------+----------+----------+----------+----------+

    updateSelectedCount = -&gt;
      elem.find(&quot;.selected-count&quot;).html( selectedCount() )

    selectedCount = -&gt;
      elem.find(&quot;.item.selected&quot;).length

    maxSelectedEnabled = -&gt;
      settings.maxSelected &gt; 0

    # adds a ThingyItem to the ThingyPicker
    addItem = (item) -&gt;
      elem.find(&quot;.items&quot;).append(item.$el)
      item.select() if item.data.id in settings.preSelectedItems


    updateMaxSelectedMessage = -&gt;
      message = settings.labels.max_selected_message.replace(&quot;{0}&quot;, selectedCount()).replace(&quot;{1}&quot;, settings.maxSelected)
      $(&quot;.max-selected-wrapper&quot;).html( message )

    # ----------+----------+----------+----------+----------+----------+----------+
    # Initialization of container
    # ----------+----------+----------+----------+----------+----------+----------+
    elem.html(
      &quot;&lt;div class=&#x27;thingy-picker&#x27;&gt;&quot; +
      &quot;    &lt;div class=&#x27;inner-header&#x27;&gt;&quot; +
      &quot;        &lt;span class=&#x27;filter-label&#x27;&gt;#{settings.labels.find_items}&lt;/span&gt;&lt;input type=&#x27;text&#x27; class=&#x27;filter&#x27; value=&#x27;#{settings.labels.filter_placeholder}&#x27;/&gt;&quot; +
      &quot;        &lt;a class=&#x27;filter-link selected&#x27; data-tp-action=&#x27;filterAll&#x27; href=&#x27;#&#x27;&gt;#{settings.labels.all}&lt;/a&gt;&quot; +
      &quot;        &lt;a class=&#x27;filter-link&#x27; data-tp-action=&#x27;filterSelected&#x27; href=&#x27;#&#x27;&gt;#{settings.labels.selected} (&lt;span class=&#x27;selected-count&#x27;&gt;0&lt;/span&gt;)&lt;/a&gt;&quot; +
      (if settings.maxSelected &gt; 0 then &quot;&lt;div class=&#x27;max-selected-wrapper&#x27;&gt;&lt;/div&gt;&quot; else &quot;&quot;) +
      &quot;    &lt;/div&gt;&quot; +
      &quot;    &lt;div class=&#x27;items&#x27;&gt;&lt;/div&gt;&quot; +
      &quot;&lt;/div&gt;&quot;
    )

    item_container = elem.find(&quot;.items&quot;)
    container = elem.find(&quot;.thingy-picker&quot;)
    buffer = []
    selectedClass = &quot;&quot;

    $.each(settings.items, (i, data) -&gt;
      item = new ThingyItem(data, picker)

      item.$el.on &#x27;selection-changed&#x27;, -&gt;
        updateMaxSelectedMessage()
        updateSelectedCount()

        picker.$el.trigger(&#x27;jfmfs.selection.changed&#x27;, item)


      console.log &quot;item&quot;, item
      addItem(item)
    );

    all_items = $(&quot;.item&quot;, elem);

    # filter by selected, hide all non-selected
    elem.find(&quot;[data-tp-action=&#x27;filterSelected&#x27;]&quot;).click (event) -&gt;
      event.preventDefault()
      elem.find(&quot;.items&quot;).addClass(&quot;filter-unselected&quot;)

      all_items.not(&quot;.selected&quot;).addClass(&quot;hide-non-selected&quot;)
      $(&quot;.filter-link&quot;).removeClass(&quot;selected&quot;)
      $(this).addClass(&quot;selected&quot;)

    # remove filter, show all
    elem.find(&quot;[data-tp-action=&#x27;filterAll&#x27;]&quot;).click (event) -&gt;
      event.preventDefault()
      elem.find(&quot;.items&quot;).removeClass(&quot;filter-unselected&quot;)

      all_items.removeClass(&quot;hide-non-selected&quot;)
      $(&quot;.filter-link&quot;).removeClass(&quot;selected&quot;)
      $(this).addClass(&quot;selected&quot;)

    # hover effect on items
    elem.find(&quot;.item:not(.selected)&quot;).on &#x27;hover&#x27;, (ev) -&gt;
      if (ev.type == &#x27;mouseover&#x27;)
        $(this).addClass(&quot;hover&quot;)
      if (ev.type == &#x27;mouseout&#x27;)
        $(this).removeClass(&quot;hover&quot;)

    # filter as you type
    elem.find(&quot;input.filter&quot;).keyup(-&gt;
      filter = $(this).val()
      clearTimeout(keyUpTimer)
      keyUpTimer = setTimeout(-&gt;
        all_items.each (index, item) -&gt;
          $item = $(item)
          if settings.isItemFiltered($item, filter)
            $item.addClass(&#x27;filtered&#x27;)
          else
            $item.removeClass(&#x27;filtered&#x27;)
      , 400)
    ).focus( -&gt;
      if $.trim($(this).val()) == &#x27;Start typing a name&#x27;
        $(this).val(&#x27;&#x27;)
    ).blur( -&gt;
      if($.trim($(this).val()) == &#x27;&#x27;)
        $(this).val(&#x27;Start typing a name&#x27;)
    )

    # hover states on the buttons
    elem.find(&quot;.button&quot;).hover( -&gt;
      $(this).addClass(&quot;button-hover&quot;)
    , -&gt;
      $(this).removeClass(&quot;button-hover&quot;)
    )

    updateMaxSelectedMessage()
    updateSelectedCount()
    elem.trigger(&quot;jfmfs.itemload.finished&quot;)

    return this

  $.fn.thingyPicker = (option)-&gt;
    # kinda like bootstrap does it:
    # https://github.com/twitter/bootstrap/blob/master/js/bootstrap-dropdown.js#L134
    this.map -&gt;
      $this = $(this)
      data = $this.data(&#x27;thingyPicker&#x27;)

      if !data
        $this.data(&#x27;thingyPicker&#x27;, data = new ThingyPicker(this, option))
        return this
      else if (typeof option == &#x27;string&#x27;)
        data[option].call($this)
      else
        console.log &quot;you should call thingyPicker with initializer or command&quot;
        return this

)(jQuery)
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
